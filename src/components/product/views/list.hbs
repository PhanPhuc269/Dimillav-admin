<section class="product-list">
    <div class="container py-5">
        <h1 class="text-center mb-4">Product List</h1>

        <div class="row">
            <!-- Sidebar Filter -->
            <div class="col-lg-3 mb-4">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-primary text-white text-center">
                        <h5 class="mb-0">Filter Options</h5>
                    </div>
                    <div class="card-body">
                        <form id="filter-form" method="GET" action="/product/filter">
                            <!-- Search -->
                            <div class="mb-3">
                                <label for="keyword" class="form-label fw-bold">
                                    <i class="bi bi-search"></i> Search by Name:
                                </label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="keyword" name="keyword" placeholder="Search products..." value="{{keyword}}">
                                    <button class="btn btn-primary" type="submit">Search</button>
                                </div>
                            </div>

                            <!-- Categories -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">
                                    <i class="bi bi-tags"></i> Categories:
                                </label>
                                <div class="d-flex flex-wrap gap-2">
                                    {{#each categories}}
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="category-{{this}}" name="category" value="{{this}}" {{#if (includes ../formData.category this)}}checked{{/if}}>
                                            <label class="form-check-label" for="category-{{this}}">{{this}}</label>
                                        </div>
                                    {{/each}}
                                </div>
                            </div>

                            <!-- Brands -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">
                                    <i class="bi bi-basket"></i> Brands:
                                </label>
                                <div class="d-flex flex-wrap gap-2">
                                    {{#each brands}}
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="brand-{{this}}" name="brand" value="{{this}}" {{#if (includes ../formData.brand this)}}checked{{/if}}>
                                            <label class="form-check-label" for="brand-{{this}}">{{this}}</label>
                                        </div>
                                    {{/each}}
                                </div>
                            </div>

                            <button class="btn btn-success w-100 mt-3" type="submit">
                                <i class="bi bi-filter"></i> Apply Filters
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <!-- Sort Dropdown -->
                    <div>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-arrow-down-up"></i> Sort By
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                                <li><a class="dropdown-item" href="?sort=creation_time_desc&keyword={{keyword}}">Creation Time (Newest)</a></li>
                                <li><a class="dropdown-item" href="?sort=creation_time_asc&keyword={{keyword}}">Creation Time (Oldest)</a></li>
                                <li><a class="dropdown-item" href="?sort=price_asc&keyword={{keyword}}">Price (Low to High)</a></li>
                                <li><a class="dropdown-item" href="?sort=price_desc&keyword={{keyword}}">Price (High to Low)</a></li>
                                <li><a class="dropdown-item" href="?sort=total_purchase_desc&keyword={{keyword}}">Total Purchase (High to Low)</a></li>
                                <li><a class="dropdown-item" href="?sort=total_purchase_asc&keyword={{keyword}}">Total Purchase (Low to High)</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Product Cards -->
                {{#if products.length}}
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        {{#each products}}
                            <div class="col">
                                <div class="card shadow-sm h-100 border-0">
                                    <img src="{{this.image}}" alt="{{this.name}}" class="card-img-top img-fluid">
                                    <div class="card-body">
                                        <h5 class="card-title text-primary">{{this.name}}</h5>
                                        <p class="card-text text-muted mb-1">Price: <span class="fw-bold">{{this.price}}</span> VND</p>
                                    </div>
                                    <div class="card-footer bg-light d-flex justify-content-between align-items-center">
                                        <a href="/product/update/{{this.slug}}" class="btn btn-outline-primary btn-sm">
                                            <i class="bi bi-pencil"></i> Edit
                                        </a>
                                        <form action="/product/delete/{{this.slug}}" method="POST" style="margin: 0;">
                                            <button type="submit" class="btn btn-outline-danger btn-sm">
                                                <i class="bi bi-trash"></i> Delete
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        {{/each}}
                    </div>

                    <!-- Pagination -->
                    {{#if (gt totalPages 1)}}
                        <nav class="mt-5">
                            <ul class="pagination justify-content-center">
                                <!-- Previous Button -->
                                <li class="page-item {{#unless (gt currentPage 1)}}disabled{{/unless}}">
                                    <a class="page-link" href="?page={{sub currentPage 1}}&keyword={{keyword}}&category={{formData.category}}&brand={{formData.brand}}&sort={{sort}}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>

                                <!-- Page Numbers -->
                                {{#each (range 1 totalPages)}}
                                    <li class="page-item {{#if (eq this ../currentPage)}}active{{/if}}">
                                        <a class="page-link" href="?page={{this}}&keyword={{../keyword}}&category={{../formData.category}}&brand={{../formData.brand}}&sort={{../sort}}">{{this}}</a>
                                    </li>
                                {{/each}}

                                <!-- Next Button -->
                                <li class="page-item {{#unless (lt currentPage totalPages)}}disabled{{/unless}}">
                                    <a class="page-link" href="?page={{add currentPage 1}}&keyword={{keyword}}&category={{formData.category}}&brand={{formData.brand}}&sort={{sort}}" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    {{/if}}
                {{else}}
                    <div class="alert alert-warning text-center mt-4">
                        No products available.
                    </div>
                {{/if}}
            </div>
        </div>
    </div>
</section>
